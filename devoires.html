<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ“š Ù…ÙƒØªØ¨Ø© ÙØ±ÙˆØ¶ Ø§Ù„Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠØ§</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body{font-family:sans-serif;background:#f4f4f4;margin:0;padding:0}
    header{background:#222;color:#fff;padding:1rem;text-align:center}
    .container{max-width:1200px;margin:auto;padding:1rem}
    .projects-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:1rem}
    .project-card{background:#fff;padding:1rem;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);text-align:center}
    .project-card h3{margin:0 0 0.5rem}
    .download-btn{display:inline-block;margin:0.2rem;padding:0.4rem 0.8rem;background:#007bff;color:#fff;border:none;border-radius:5px;text-decoration:none;cursor:pointer}
    .download-btn:hover{background:#0056b3}
    .search-box input{width:100%;padding:0.5rem;margin:1rem 0;border-radius:5px;border:1px solid #ccc}
    .filter-box{margin-bottom:1rem}
    .filter-box select{padding:0.4rem;border-radius:5px;border:1px solid #ccc;margin-left:0.5rem}
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<header>
  <div class="container header-inner">
    <img src="logo.png" class="logo" style="height:50px">
    <h1>ğŸ“š Ù…ÙƒØªØ¨Ø© ÙØ±ÙˆØ¶ Ø§Ù„Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠØ§</h1>
  </div>
</header>

<main class="container">

<section class="projects-section">

  <div class="project-box">
    <h2 id="page-title">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</h2>
    <p class="box-desc">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¹Ø¨Ø© Ù„Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¶</p>

    <div class="projects-grid" id="sectionsGrid">
      <div class="project-card" onclick="openSection('technique')"><h3>âš™ï¸ ØªÙ‚Ù†ÙŠØ©</h3></div>
      <div class="project-card" onclick="openSection('informatique')"><h3>ğŸ’» Ø¥Ø¹Ù„Ø§Ù…ÙŠØ©</h3></div>
      <div class="project-card" onclick="openSection('maths')"><h3>ğŸ“ Ø±ÙŠØ§Ø¶ÙŠØ§Øª</h3></div>
      <div class="project-card" onclick="openSection('sciences')"><h3>ğŸ§ª Ø¹Ù„ÙˆÙ…</h3></div>
      <div class="project-card" onclick="openSection('eco_gestion')"><h3>ğŸ“Š Ø§Ù‚ØªØµØ§Ø¯ ÙˆØªØµØ±Ù</h3></div>
      <div class="project-card" onclick="openSection('arabia')"><h3>ğŸ“– Ø¢Ø¯Ø§Ø¨</h3></div>
    </div>

  </div>

  <!-- ğŸ” Ø¨Ø­Ø« -->
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙØ±Ø¶ Ø£Ùˆ Ø§Ù„Ø³Ù†Ø©...">
  </div>

  <!-- ğŸ—‚ï¸ ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø© -->
  <div class="filter-box">
    Ø³Ù†Ø©: 
    <select id="yearFilter">
      <option value="all">Ø§Ù„ÙƒÙ„</option>
      <option value="2023">2023</option>
      <option value="2022">2022</option>
      <option value="2021">2021</option>
    </select>
    ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨: 
    <select id="sortFilter">
      <option value="downloadsDesc">Ø§Ù„Ø£ÙƒØ«Ø± ØªØ­Ù…ÙŠÙ„Ø§Ù‹</option>
      <option value="downloadsAsc">Ø§Ù„Ø£Ù‚Ù„ ØªØ­Ù…ÙŠÙ„Ø§Ù‹</option>
      <option value="titleAsc">Ø£Ø¨Ø¬Ø¯ÙŠØ§Ù‹ â†‘</option>
      <option value="titleDesc">Ø£Ø¨Ø¬Ø¯ÙŠØ§Ù‹ â†“</option>
    </select>
  </div>

  <!-- Container for filtered devoirs -->
  <div class="projects-grid" id="devoirsGrid"></div>

</section>

</main>

<script>
  // ================= Firebase Config =================
  const firebaseConfig = {
    apiKey: "AIzaSy...YOUR_API_KEY",
    authDomain: "your-app.firebaseapp.com",
    databaseURL: "https://your-app-default-rtdb.firebaseio.com",
    projectId: "your-app",
    storageBucket: "your-app.appspot.com",
    messagingSenderId: "123456789",
    appId: "1:123456789:web:abc123"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ================= Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¶ =================
  const data = {
    maths: Array.from({length:10}, (_,i)=>({title:`Ø±ÙŠØ§Ø¶ÙŠØ§Øª ${i+1}`, year:2023, file:`devoires/maths/maths-${i+1}.pdf`, downloads:0})),
    informatique: Array.from({length:10}, (_,i)=>({title:`Algorithmique ${i+1}`, year:2023, file:`devoires/informatique/algo-${i+1}.pdf`, downloads:0})),
    technique: Array.from({length:10}, (_,i)=>({title:`Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ${i+1}`, year:2023, file:`devoires/technique/electronique-${i+1}.pdf`, downloads:0})),
    sciences: Array.from({length:10}, (_,i)=>({title:`Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ© ${i+1}`, year:2023, file:`devoires/sciences/svt-${i+1}.pdf`, downloads:0})),
    eco_gestion: Array.from({length:10}, (_,i)=>({title:`Ø§Ù‚ØªØµØ§Ø¯ ${i+1}`, year:2023, file:`devoires/eco_gestion/eco-${i+1}.pdf`, downloads:0})),
    arabia: Array.from({length:10}, (_,i)=>({title:`ÙÙ„Ø³ÙØ© ${i+1}`, year:2023, file:`devoires/arabia/philo-${i+1}.pdf`, downloads:0}))
  };

  // ================= Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø¹Ø¨Ø© =================
  function openSection(sec){
    window.location.href = "devoires.html?section=" + sec;
  }

  const params = new URLSearchParams(window.location.search);
  const section = params.get("section");

  function loadDevoirs(sec){
    document.getElementById("page-title").innerHTML = "ğŸ“‚ ÙØ±ÙˆØ¶ Ø´Ø¹Ø¨Ø© " + sec;
    renderDevoirs(sec, data[sec]);
  }

  // ================= Ø¹Ø±Ø¶ Ø§Ù„ÙØ±ÙˆØ¶ =================
  function renderDevoirs(sec, list){
    const grid = document.getElementById("devoirsGrid");
    grid.innerHTML = "";
    list.forEach((d, idx) => {
      const card = document.createElement("div");
      card.classList.add("project-card");
      card.innerHTML = `
        <h3>${d.title} (${d.year})</h3>
        <button class="download-btn" onclick="viewPDF('${sec}',${idx})">ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯Ø©</button>
        <a href="${d.file}" download class="download-btn" onclick="incrementDownload('${sec}',${idx})">ğŸ“¥ ØªØ­Ù…ÙŠÙ„</a>
        <small>â­ ${d.downloads} ØªØ­Ù…ÙŠÙ„Ø§Øª</small>
      `;
      grid.appendChild(card);
    });
  }

  function viewPDF(sec, idx){ window.open(data[sec][idx].file,"_blank"); }

  function incrementDownload(sec, idx){
    data[sec][idx].downloads++;
    db.ref(`downloads/${sec}-${idx}`).set(data[sec][idx].downloads);
    renderDevoirs(sec, data[sec]);
  }

  // ================= Ø¨Ø­Ø« Ù…Ø¨Ø§Ø´Ø± =================
  const searchInput = document.getElementById("searchInput");
  searchInput.addEventListener("input", () => applyFilters());

  const yearFilter = document.getElementById("yearFilter");
  const sortFilter = document.getElementById("sortFilter");
  yearFilter.addEventListener("change", applyFilters);
  sortFilter.addEventListener("change", applyFilters);

  function applyFilters(){
    if(!section) return;
    let filtered = data[section].filter(d => 
      d.title.toLowerCase().includes(searchInput.value.toLowerCase()) || 
      d.year.toString().includes(searchInput.value)
    );
    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø©
    if(yearFilter.value !== "all") filtered = filtered.filter(d=>d.year.toString()===yearFilter.value);
    // ØªØ±ØªÙŠØ¨
    if(sortFilter.value==="downloadsDesc") filtered.sort((a,b)=>b.downloads-a.downloads);
    else if(sortFilter.value==="downloadsAsc") filtered.sort((a,b)=>a.downloads-b.downloads);
    else if(sortFilter.value==="titleAsc") filtered.sort((a,b)=>a.title.localeCompare(b.title));
    else if(sortFilter.value==="titleDesc") filtered.sort((a,b)=>b.title.localeCompare(a.title));
    renderDevoirs(section, filtered);
  }

  if(section) loadDevoirs(section);

</script>

</body>
</html>
