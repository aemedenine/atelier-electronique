<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Robo V6 - Atelier Ã‰lectronique MÃ©denine ğŸ¤–</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin: 15px 0;
      text-shadow: 0 0 10px #0ff;
    }
    #robo-v6-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 420px;
      padding: 10px;
    }
    model-viewer#robo-v6 {
      width: 260px;
      height: 260px;
      border-radius: 50%;
      box-shadow: 0 0 50px rgba(255, 165, 0, 0.6);
      background: rgba(255,255,255,0.05);
      transition: all 0.4s ease;
      cursor: pointer;
    }
    #robo-v6-chat {
      margin-top: 20px;
      width: 100%;
    }
    #robo-messages {
      background: rgba(0,0,0,0.6);
      padding: 12px;
      border-radius: 12px;
      max-height: 320px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .message {
      margin: 10px 0;
      padding: 12px 16px;
      border-radius: 20px;
      max-width: 80%;
      word-wrap: break-word;
      font-size: 0.98em;
    }
    .user { background: #1e8449; margin-left: auto; }
    .bot { background: rgba(255,165,0,0.25); margin-right: auto; }
    .input-area { display: flex; margin-top: 12px; }
    .input-area input[type="text"] {
      flex: 1;
      padding: 14px 16px;
      border-radius: 30px 0 0 30px;
      border: none;
      outline: none;
      font-size: 1em;
    }
    .input-area button {
      padding: 14px 24px;
      border-radius: 0 30px 30px 0;
      background: #ffa500;
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    .input-area button:hover { background: #e69500; }
    #upload-image { margin: 10px 0; display: none; }
    .whatsapp-btn {
      display: none;
      margin: 12px auto;
      padding: 12px 24px;
      background: #25D366;
      color: white;
      border-radius: 30px;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Robo V6 ğŸ¤– - ÙˆØ±Ø´Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙƒ Ø§Ù„Ø±Ø­Ù…Ø§Ù†ÙŠ</h1>
  
  <div id="robo-v6-container">
    <model-viewer id="robo-v6" src="robo.glb"
                  alt="Robo Tounsi 3D"
                  auto-rotate
                  camera-controls
                  shadow-intensity="1"
                  rotation-per-second="32deg">
    </model-viewer>

    <div id="robo-v6-chat">
      <div id="robo-messages"></div>
      
      <div class="input-area">
        <input id="robo-input" type="text" placeholder="S2el Robo... (Ù…Ø«Ø§Ù„: Ø­Ø¬Ø²ØŒ ØªØµÙ„ÙŠØ­ØŒ Ø´ÙŠÙ…Ø©)" autofocus />
        <button onclick="sendRoboMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
      </div>
      
      <input id="upload-image" type="file" accept="image/*" onchange="handleImageUpload()" />
      <a href="#" id="whatsapp-link" class="whatsapp-btn" target="_blank">ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>
    </div>
  </div>

  <script>
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Firebase Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const firebaseConfig = {
      apiKey: "AIzaSyCtbEWdm7CAC25ROslGlVeLOvfxdi2exVo",
      authDomain: "atelier-electronique-mednine.firebaseapp.com",
      projectId: "atelier-electronique-mednine",
      storageBucket: "atelier-electronique-mednine.firebasestorage.app",
      messagingSenderId: "547430908384",
      appId: "1:547430908384:web:4caa4cf3869491bd14eb85",
      databaseURL: "https://atelier-electronique-mednine-default-rtdb.europe-west1.firebasedatabase.app"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();
    const analytics = firebase.analytics();

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const roboV6 = document.getElementById('robo-v6');
    const messagesDiv = document.getElementById('robo-messages');
    const input = document.getElementById('robo-input');
    const uploadInput = document.getElementById('upload-image');
    const whatsappLink = document.getElementById('whatsapp-link');

    let userPhone = null;
    let currentRequest = { type: null, description: '', step: 0 };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addMessage(text, type) {
      const msg = document.createElement('div');
      msg.className = `message ${type}`;
      msg.textContent = text;
      messagesDiv.appendChild(msg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      
      if (type === 'bot') {
        roboV6.style.transform = 'scale(1.12)';
        setTimeout(() => roboV6.style.transform = 'scale(1)', 600);
      }
    }

    function showUpload() {
      uploadInput.style.display = 'block';
    }

    function showWhatsApp(preText = '') {
      const msg = currentRequest.description || input.value.trim();
      const waText = preText + encodeURIComponent(`Ahla, ${msg}`);
      whatsappLink.href = `https://wa.me/21698192103?text=${waText}`;
      whatsappLink.style.display = 'inline-block';
    }

    function resetRequest() {
      currentRequest = { type: null, description: '', step: 0 };
      uploadInput.style.display = 'none';
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Main Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function sendRoboMsg() {
      const text = input.value.trim();
      if (!text) return;

      addMessage(text, 'user');
      input.value = '';

      let reply = 'Ø¢Ø³Ù... Ù…Ø§ ÙÙ‡Ù…ØªØ´ Ù…Ù„ÙŠØ­ ğŸ˜… Ù‚Ù„Ù‘ÙŠ Ø´Ù†Ùˆ Ø¨Ø§Ù„Ø¶Ø¨Ø· (ØªØµÙ„ÙŠØ­ØŒ Ø­Ø¬Ø²ØŒ Ø´ÙŠÙ…Ø©ØŒ ÙƒÙˆØ±Ø³...)';
      const lower = text.toLowerCase();

      if (lower.includes('Ø­Ø¬Ø²') || lower.includes('Ù…ÙˆØ¹Ø¯') || lower.includes('appointment')) {
        currentRequest.type = 'booking';
        currentRequest.step = 1;
        reply = 'ØªÙ…Ø§Ù…! Ù‚Ù„Ù‘ÙŠ:\n1. Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ù„ÙŠ ØªÙ†Ø§Ø³Ø¨Ùƒ\n2. Ø´Ù†Ùˆ Ø§Ù„Ù…Ø´ÙƒÙ„ (ØºØ³Ø§Ù„Ø©ØŒ ÙƒÙ„ÙŠÙ…Ø§...)\n3. Ø±Ù‚Ù… ØªÙ„ÙŠÙÙˆÙ†Ùƒ';
      
      } else if (currentRequest.type === 'booking') {
        currentRequest.description = text;
        try {
          await db.ref('bookings').push({
            phone: userPhone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
            details: text,
            createdAt: firebase.database.ServerValue.TIMESTAMP,
            status: 'pending'
          });
          reply = 'Ø­Ø¬Ø²Ùƒ ØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡ Ø¨Ù†Ø¬Ø§Ø­! Ù†ØªØµÙ„ Ø¨ÙŠÙƒ Ù‚Ø±ÙŠØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù„ÙŠ Ø¹Ø·ÙŠØªÙ†ÙŠ ğŸš€';
          resetRequest();
        } catch (e) {
          reply = 'ÙÙ…Ø§ÙƒØ´ Ù…Ø´ÙƒÙ„ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„... Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§ØªØµÙ„ 98 192 103';
        }

      } else if (lower.includes('ØªØµÙ„ÙŠØ­') || lower.includes('repair') || lower.includes('ÙƒØ±Øª') || lower.includes('Ø¨ÙˆØ±Ø¯Ø©')) {
        currentRequest.type = 'repair';
        currentRequest.step = 1;
        reply = 'Ø§Ù‡Ù„Ø§! Ø´Ù†Ùˆ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŸ (ØºØ³Ø§Ù„Ø©ØŒ ÙƒÙ„ÙŠÙ…Ø§ØŒ Ù…Ø§ÙƒÙŠÙ†Ø© Ù„Ø­Ø§Ù…...)\nÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„ Ø¨Ø§Ø®ØªØµØ§Ø±ØŒ ÙˆØ±Ù‚Ù… ØªÙ„ÙŠÙÙˆÙ†Ùƒ Ø¥Ø°Ø§ ØªØ­Ø¨.\nØ¨Ø¹Ø¯ÙŠÙ† ØªÙ‚Ø¯Ø± ØªØ±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ÙƒØ±Øª.';
        showUpload();

      } else if (currentRequest.type === 'repair' && currentRequest.step === 1) {
        currentRequest.description = text;
        currentRequest.step = 2;
        reply = 'Ø´ÙƒØ±Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ§ØµÙŠÙ„! Ø¥Ø°Ø§ Ø¹Ù†Ø¯Ùƒ ØµÙˆØ±Ø© Ù„Ù„ÙƒØ±Øª Ø§Ø±ÙØ¹Ù‡Ø§ ØªØ§ÙˆØ§ØŒ ÙˆØ¥Ù„Ø§ Ù†ÙƒÙ…Ù„ Ø¨Ø¯ÙˆÙ†.';
        showUpload();

      } else if (lower.includes('Ø´ÙŠÙ…Ø©') || lower.includes('schÃ©ma')) {
        reply = 'Ø¹Ù†Ø¯Ù†Ø§ Ø´ÙŠÙ…Ø§Øª ÙƒØ«ÙŠØ±Ø© (Samsung, LG, Gree, ÙƒØ±ÙˆØª ØµÙ†Ø§Ø¹ÙŠØ©...). Ù‚Ù„Ù‘ÙŠ Ø§Ù„Ù…Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø¨Ø§Ù„Ø¶Ø¨Ø· Ø¨Ø§Ø´ Ù†Ø¨Ø­Ø«Ù„Ùƒ.';
        showWhatsApp('ØªØ­Ø¨ Ø´ÙŠÙ…Ø© Ù„Ù€ ');

      } else if (lower.includes('ÙƒÙˆØ±Ø³') || lower.includes('cours') || lower.includes('Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ')) {
        reply = 'Ø¹Ù†Ø¯Ù†Ø§ ÙƒÙˆØ±Ø³Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙƒ + Ù…Ø´Ø§Ø±ÙŠØ¹ Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ. ØªØ­Ø¨ Ù†Ø¨Ø¯Ø£ Ø¨Ø´Ù†ÙˆØŸ (Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ Ù…Ø´Ø±ÙˆØ¹ Ø¥Ø¶Ø§Ø¡Ø© Ø°ÙƒÙŠØ©...)';
      
      } else if (lower.includes('ÙˆÙŠÙ†ÙƒÙ…') || lower.includes('Ø¹Ù†ÙˆØ§Ù†')) {
        reply = 'Ù…Ø¯Ù†ÙŠÙ† â€“ Ù†Ù‡Ø¬ Ù„ÙŠØ¨ÙŠØ§ØŒ Ø¨Ø¹Ø¯ ÙƒÙˆØ´Ø© Ø´Ø§Ù…Ø®ØŒ Ø£ÙˆÙ„ Ø·Ù„Ø¹Ø© ÙŠÙ…ÙŠÙ†. Ø±Ù‚Ù…: 98 192 103';

      } else {
        // Ø­ÙØ¸ Ø±Ù‚Ù… Ø¥Ø°Ø§ ÙˆØ¬Ø¯ (Ø¨Ø³ÙŠØ·)
        if (/\d{8}/.test(text)) {
          userPhone = text.match(/\d{8}/)[0];
          reply = `Ø´ÙƒØ±Ù‹Ø§ØŒ Ø­ÙØ¸Øª Ø±Ù‚Ù…Ùƒ ${userPhone}. Ø´Ù†Ùˆ Ù†Ø¹Ø§ÙˆÙ†Ùƒ ÙÙŠÙ‡ ØªØ§ÙˆØ§ØŸ`;
        }
      }

      setTimeout(() => addMessage(reply, 'bot'), 900);
    }

    // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© + Ø­ÙØ¸ ÙÙŠ Firebase
    function handleImageUpload() {
      const file = uploadInput.files[0];
      if (!file) return;

      addMessage('Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©...', 'bot');

      const fileName = Date.now() + '_' + file.name;
      const storageRef = storage.ref('repair_images/' + fileName);

      storageRef.put(file).then(snapshot => {
        return snapshot.ref.getDownloadURL();
      }).then(url => {
        db.ref('repair_requests').push({
          phone: userPhone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
          description: currentRequest.description || 'Ø¨Ø¯ÙˆÙ† ÙˆØµÙ',
          imageUrl: url,
          createdAt: firebase.database.ServerValue.TIMESTAMP,
          status: 'new'
        });

        addMessage('Ø§Ù„ØµÙˆØ±Ø© ÙˆØµÙ„Øª ÙˆØ§Ù„Ø·Ù„Ø¨ Ù…Ø³Ø¬Ù‘Ù„! Ù†ØªØµÙ„ Ø¨ÙŠÙƒ Ù‚Ø±ÙŠØ¨ Ù„Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø³Ø¹Ø± ğŸ˜', 'bot');
        showWhatsApp('Ø¹Ù†Ø¯ÙŠ Ø·Ù„Ø¨ ØªØµÙ„ÙŠØ­ Ù…Ø¹ ØµÙˆØ±Ø©: ');
        resetRequest();
      }).catch(err => {
        addMessage('Ù…Ø´ÙƒÙ„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©... Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø£Ø±Ø³Ù„Ù‡Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø©.', 'bot');
      });

      uploadInput.value = '';
    }

    // Enter key
    input.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendRoboMsg();
    });

    // Hover effect
    roboV6.addEventListener('pointerenter', () => roboV6.style.transform = 'scale(1.08)');
    roboV6.addEventListener('pointerleave', () => roboV6.style.transform = 'scale(1)');

    // Welcome
    addMessage('Ahla ÙŠØ§ Ø®ÙˆÙŠØ§! Ana Robo V6 Ù…Ù† ÙˆØ±Ø´Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙƒ Ø§Ù„Ø±Ø­Ù…Ø§Ù†ÙŠ.\nÙ†ØµÙ„Ø­ ÙƒØ±ÙˆØª (ØºØ³Ø§Ù„Ø§ØªØŒ ÙƒÙ„ÙŠÙ…Ø§ØŒ Ù„Ø­Ø§Ù…ØŒ Ù…ÙˆØ§Ø²ÙŠÙ†...)ØŒ Ù†Ø­Ø¬Ø² Ù…ÙˆØ§Ø¹ÙŠØ¯ØŒ Ù†Ø´Ø§Ø±Ùƒ Ø´ÙŠÙ…Ø§Øª ÙˆÙƒÙˆØ±Ø³Ø§Øª.\nØ´Ù†Ùˆ Ù†Ø­Ø¨ Ù†Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠÙ‡ Ø§Ù„ÙŠÙˆÙ…ØŸ ğŸš€', 'bot');
  </script>
</body>
</html>
