<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ðŸ¤– Robo AI - Ù„Ø¨ÙŠØ¨Ø©</title>

  <style>
    body {
      margin: 0;
      background: radial-gradient(circle at top, #111, #000);
      font-family: Arial, Tahoma;
      color: white;
    }

    #container {
      width: 100%;
      height: 60vh;
    }

    #chat {
      max-width: 700px;
      margin: 15px auto;
      text-align: right;
      padding: 10px;
    }

    #messages {
      background: rgba(20,20,20,0.9);
      padding: 15px;
      border-radius: 15px;
      height: 260px;
      overflow-y: auto;
      box-shadow: 0 0 20px #00ffcc44;
    }

    .user {
      color: #00ff00;
      text-align: left;
      margin: 8px 0;
    }

    .bot {
      color: #00ffff;
      margin: 8px 0;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    input {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      outline: none;
    }

    button {
      padding: 12px 25px;
      background: linear-gradient(135deg,#00ffcc,#00ff00);
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <div id="container"></div>

  <div id="chat">
    <div id="messages"></div>

    <div class="controls">
      <input id="input" placeholder="Ø§Ø³Ø£Ù„ Ø§Ù„Ø±ÙˆØ¨Ùˆ..." />
      <button onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.168/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.168/examples/js/loaders/GLTFLoader.min.js"></script>

  <script>
    // ===== Three.js =====

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x080808);

    const camera = new THREE.PerspectiveCamera(
      60,
      window.innerWidth / (window.innerHeight * 0.6),
      0.1,
      1000
    );

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight * 0.6);
    document.getElementById("container").appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0xffffff, 0.6));

    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(3, 6, 4);
    scene.add(dirLight);

    let robot, talking = false;

   const loader = new THREE.GLTFLoader();
loader.setCrossOrigin("anonymous");

loader.load("./robot.glb", gltf => {

      robot = gltf.scene;
      robot.scale.set(1.5,1.5,1.5);
      robot.position.y = -1;
      scene.add(robot);
      animate();
    });

    camera.position.set(0,1.3,4);

    function animate(){
      requestAnimationFrame(animate);

      if(robot){
        if(talking){
          robot.rotation.y += 0.03;
          robot.position.y = -1 + Math.sin(Date.now()*0.01)*0.05;
        } else {
          robot.rotation.y += 0.005;
        }
      }

      renderer.render(scene,camera);
    }

    window.addEventListener("resize", ()=>{
      camera.aspect = window.innerWidth / (window.innerHeight * 0.6);
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight * 0.6);
    });

    // ===== Chat AI =====

    const apiKey = "AIzaSyAU9A_bz_T9jrstr--V8m8TcJoFtKW9YO4";   // Ø­Ø· Ø§Ù„ÙƒÙŠ Ù…ØªØ§Ø¹Ùƒ Ù‡Ù†Ø§

    const messagesDiv = document.getElementById("messages");
    const input = document.getElementById("input");

    async function send(){
      const text = input.value.trim();
      if(!text) return;

      addMsg(text,"user");
      input.value = "";

      talking = true;

      try{
        const res = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,
          {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({
              contents:[{parts:[{text}]}]
            })
          }
        );

        const data = await res.json();
        const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "Ù…Ø§ ÙÙ‡Ù…ØªØ´ ðŸ˜…";

        addMsg(reply,"bot");
        speak(reply);
      }
      catch(e){
        addMsg("âš ï¸ Ù…Ø´ÙƒÙ„Ø© Ø§ØªØµØ§Ù„","bot");
      }

      talking = false;
    }

    function addMsg(text,who){
      const div = document.createElement("div");
      div.className = who;
      div.textContent = text;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    input.addEventListener("keydown", e=>{
      if(e.key==="Enter") send();
    });

    function speak(text){
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "ar-TN";
      speechSynthesis.speak(u);
    }
  </script>

</body>
</html>
