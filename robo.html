<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Robo Sghir mte3i - Jism Robot</title>
  <style>
    body { margin:0; background:#000; font-family:Arial; color:white; }
    #container { width:100%; height:60vh; }
    #chat { max-width:600px; margin:20px auto; text-align:right; }
    #messages { background:#111; padding:15px; border-radius:10px; height:250px; overflow-y:auto; }
    .user { color:#0f0; text-align:left; margin:10px 0; }
    .bot { color:#0ff; }
    input { width:70%; padding:10px; font-size:16px; }
    button { padding:10px 20px; background:#0f0; border:none; cursor:pointer; }
  </style>
</head>
<body>
  <div id="container"></div>

  <div id="chat">
    <div id="messages"></div>
    <input id="input" placeholder="سألني أي حاجة (إلكترونيك أو عام)..." />
    <button onclick="send()">ارسل</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.168/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.168/examples/js/loaders/GLTFLoader.min.js"></script>

  <script>
    // Three.js Setup
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x111111);
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight * 0.6, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight * 0.6);
    document.getElementById('container').appendChild(renderer.domElement);

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5, 5, 5);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    let robot;
    const loader = new THREE.GLTFLoader();
    loader.load('https://media.sketchfab.com/models/0f64197efce74fba8145b941efea323a/gltf/scene.gltf', // غير هذا برابط GLB/GLTF بعد التحميل (ارفعو على GitHub أو Netlify)
      (gltf) => {
        robot = gltf.scene;
        robot.scale.set(1.5, 1.5, 1.5); // عدل الحجم
        robot.position.y = -1;
        scene.add(robot);
        animate();
      },
      undefined,
      (err) => console.error(err)
    );

    camera.position.z = 4;

    function animate() {
      requestAnimationFrame(animate);
      if (robot) robot.rotation.y += 0.005; // دوران بسيط idle
      renderer.render(scene, camera);
    }

    // Chat AI part (Gemini API example - خذ key مجاني من https://aistudio.google.com)
    const apiKey = "YOUR_GEMINI_API_KEY_HERE"; // خذو مجاني
    const messagesDiv = document.getElementById('messages');
    const input = document.getElementById('input');

    async function send() {
      const text = input.value.trim();
      if (!text) return;
      addMsg(text, 'user');
      input.value = '';

      // حركة thinking (مثلاً دوران أسرع)
      if (robot) robot.rotation.y += 0.5; // أو غير animation إذا في animations

      try {
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ contents: [{ parts: [{ text }] }] })
        });
        const data = await res.json();
        const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "معليش، مش فاهم...";

        addMsg(reply, 'bot');
      } catch (e) {
        addMsg("في مشكلة في الاتصال، جرب تاني!", 'bot');
      }
    }

    function addMsg(text, who) {
      const div = document.createElement('div');
      div.className = who;
      div.textContent = text;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    input.addEventListener('keypress', e => { if (e.key === 'Enter') send(); });

    // Resize handler
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / (window.innerHeight * 0.6);
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight * 0.6);
    });
  </script>
</body>
</html>
